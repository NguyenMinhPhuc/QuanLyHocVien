"use strict";(()=>{var e={};e.id=26,e.ids=[26,888,660],e.modules={4926:(e,s,t)=>{t.r(s),t.d(s,{config:()=>g,default:()=>u,getServerSideProps:()=>b,getStaticPaths:()=>j,getStaticProps:()=>p,reportWebVitals:()=>N,routeModule:()=>_,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>f});var a={};t.r(a),t.d(a,{default:()=>DashboardPage});var l=t(7093),r=t(5244),d=t(1323),i=t(9209),c=t.n(i),n=t(181),h=t(997),o=t(6689),x=t(6686),m=t(5951);function DashboardPage(){let[e,s]=(0,o.useState)(null),[t,a]=(0,o.useState)(!1),[l,r]=(0,o.useState)(null);async function load(){a(!0);try{let e=await (0,x.S)("/api/dashboard");if(!e.ok)throw Error("Failed");let t=await e.json();s(t)}catch(e){r(e.message)}finally{a(!1)}}(0,o.useEffect)(()=>{load()},[]);let[d,i]=(0,o.useState)([]),[c,n]=(0,o.useState)(new Date().getFullYear()),[u,p]=(0,o.useState)(""),[j,b]=(0,o.useState)(null),[g,N]=(0,o.useState)(!1),[f,v]=(0,o.useState)(""),[S,y]=(0,o.useState)([]),[w,_]=(0,o.useState)(!1);async function openDetail(e){v(e),N(!0),_(!0),y([]);try{let s="";"students"===e?s="/api/students?limit=200":"teachers"===e?s="/api/teachers?limit=200":"classes"===e?s="/api/classes":"schedules"===e&&(s="/api/schedules?page=1&pageSize=200");let t=await (0,x.S)(s);if(!t.ok)throw Error("Failed");let a=await t.json(),l=a.rows||a;y(l||[])}catch(e){console.error("[dashboard] openDetail error",e.message),y([])}finally{_(!1)}}function getClassLabel(e,s){if(!e&&s)return s.name||s.course_name||s.class_name||"Class "+(s.id||"");let t=d.find(s=>String(s.id)===String(e));return t?t.name||t.course_name||"Class "+t.id:"Class "+e}(0,o.useEffect)(()=>{load()},[]),(0,o.useEffect)(()=>{(0,x.S)("/api/classes").then(e=>e.ok?e.json():[]).then(i).catch(()=>i([]))},[]),(0,o.useEffect)(()=>{(async function(){try{let e=new URLSearchParams({year:String(c)});u&&e.set("classId",u);let s=await (0,x.S)("/api/dashboard/revenue?"+e.toString());if(!s.ok)throw Error("Failed");let t=await s.json();b(t.rows)}catch(e){}})()},[c,u]);let P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return(0,h.jsxs)("div",{className:"p-4",children:[h.jsx("h1",{className:"text-2xl font-semibold mb-4",children:(0,m.t)("dashboard.title","Dashboard")}),l&&h.jsx("div",{className:"text-red-600 mb-2",children:l}),t&&h.jsx("div",{children:(0,m.t)("actions.loading","Đang tải...")}),e&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{className:"p-4 rounded shadow bg-indigo-600 text-white",children:[h.jsx("div",{className:"text-sm opacity-80",children:(0,m.t)("dashboard.total_students","Tổng học vi\xean")}),h.jsx("div",{onClick:()=>openDetail("students"),className:"text-3xl font-bold cursor-pointer",children:e.totalStudents})]}),(0,h.jsxs)("div",{className:"p-4 rounded shadow bg-emerald-600 text-white",children:[h.jsx("div",{className:"text-sm opacity-80",children:(0,m.t)("dashboard.total_teachers","Tổng gi\xe1o vi\xean")}),h.jsx("div",{onClick:()=>openDetail("teachers"),className:"text-3xl font-bold cursor-pointer",children:e.totalTeachers})]}),(0,h.jsxs)("div",{className:"p-4 rounded shadow bg-amber-500 text-white",children:[h.jsx("div",{className:"text-sm opacity-80",children:(0,m.t)("dashboard.total_classes","Tổng lớp")}),(0,h.jsxs)("div",{onClick:()=>openDetail("classes"),className:"text-3xl font-bold cursor-pointer",children:[e.totalClasses," ",(0,h.jsxs)("span",{className:"text-sm opacity-80",children:["(",(0,m.t)("dashboard.active","Hoạt động"),": ",e.activeClasses,")"]})]})]}),(0,h.jsxs)("div",{className:"p-4 rounded shadow bg-rose-600 text-white",children:[h.jsx("div",{className:"text-sm opacity-80",children:(0,m.t)("dashboard.schedules","Lịch")}),(0,h.jsxs)("div",{onClick:()=>openDetail("schedules"),className:"text-3xl font-bold cursor-pointer",children:[e.upcomingSessions," ",h.jsx("span",{className:"text-sm opacity-80",children:(0,m.t)("dashboard.upcoming","Sắp tới")})]})]})]}),(0,h.jsxs)("div",{className:"mt-6 p-4 bg-white rounded shadow",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[h.jsx("h2",{className:"text-lg font-semibold",children:(0,m.t)("dashboard.revenue","Doanh thu học ph\xed theo th\xe1ng")}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[h.jsx("select",{value:c,onChange:e=>n(Number(e.target.value)),className:"border px-2 py-1 rounded",children:Array.from({length:5}).map((e,s)=>{let t=new Date().getFullYear()-s;return h.jsx("option",{value:t,children:t},t)})}),(0,h.jsxs)("select",{value:u,onChange:e=>p(e.target.value),className:"border px-2 py-1 rounded",children:[h.jsx("option",{value:"",children:(0,m.t)("dashboard.all_classes","Tất cả lớp")}),d.map(e=>h.jsx("option",{value:String(e.id),children:e.name||e.id},e.id))]})]})]}),h.jsx("div",{className:"mt-4",children:(0,h.jsxs)("svg",{width:"100%",height:"240",viewBox:"0 0 800 240",children:[(j||[]).map((e,s)=>{let t=Math.max(...(j||[]).map(e=>e.total||0),1),a=40+56*s,l=Math.round((e.total||0)/t*160),r=200-l;return(0,h.jsxs)("g",{children:[h.jsx("rect",{x:a,y:r,width:40,height:l,rx:"4",fill:"#60a5fa"}),h.jsx("text",{x:a+20,y:216,fontSize:"12",fill:"#374151",textAnchor:"middle",children:P[s]}),h.jsx("text",{x:a+20,y:r-6,fontSize:"11",fill:"#111827",textAnchor:"middle",children:(e.total||0).toLocaleString()})]},s)}),h.jsx("line",{x1:"32",y1:"200",x2:"760",y2:"200",stroke:"#e5e7eb",strokeWidth:"1"})]})})]}),(0,h.jsxs)("div",{className:"mt-6 p-4 bg-white rounded shadow",children:[h.jsx("div",{className:"text-sm text-slate-500",children:(0,m.t)("dashboard.top_classes","Lớp đ\xf4ng nhất")}),h.jsx("div",{children:(0,h.jsxs)("table",{className:"min-w-full mt-2 text-sm",children:[h.jsx("thead",{children:(0,h.jsxs)("tr",{children:[h.jsx("th",{className:"text-left",children:(0,m.t)("dashboard.class","Lớp")}),h.jsx("th",{className:"text-left",children:(0,m.t)("dashboard.teacher","Gi\xe1o vi\xean")}),h.jsx("th",{className:"text-right",children:(0,m.t)("dashboard.students","Học vi\xean")})]})}),h.jsx("tbody",{children:(e.topClasses||[]).map(e=>(0,h.jsxs)("tr",{className:"border-t",children:[h.jsx("td",{className:"py-1",children:e.course_name||"Class "+e.id}),h.jsx("td",{className:"py-1",children:e.teacher_name||"-"}),h.jsx("td",{className:"py-1 text-right",children:e.student_count||0})]},e.id))})]})})]})]}),g&&h.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,h.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-11/12 md:w-3/4 max-h-[80vh] overflow-auto p-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h3",{className:"text-lg font-semibold",children:"students"===f?(0,m.t)("dashboard.students","Học vi\xean"):"teachers"===f?(0,m.t)("dashboard.teachers","Gi\xe1o vi\xean"):"classes"===f?(0,m.t)("dashboard.classes","Lớp"):(0,m.t)("dashboard.schedules","Lịch")}),h.jsx("button",{className:"text-sm px-3 py-1 rounded border",onClick:()=>N(!1),children:(0,m.t)("actions.close","Đ\xf3ng")})]}),w&&h.jsx("div",{children:(0,m.t)("actions.loading","Đang tải...")}),!w&&(0,h.jsxs)("div",{children:["students"===f&&(0,h.jsxs)("table",{className:"min-w-full text-sm",children:[h.jsx("thead",{children:(0,h.jsxs)("tr",{className:"text-left",children:[h.jsx("th",{children:(0,m.t)("students.name","T\xean")}),h.jsx("th",{children:(0,m.t)("students.phone","SĐT")}),h.jsx("th",{children:(0,m.t)("students.email","Email")})]})}),h.jsx("tbody",{children:S.map(e=>(0,h.jsxs)("tr",{className:"border-t",children:[h.jsx("td",{className:"py-1",children:e.name}),h.jsx("td",{className:"py-1",children:e.phone}),h.jsx("td",{className:"py-1",children:e.email})]},e.id))})]}),"teachers"===f&&(0,h.jsxs)("table",{className:"min-w-full text-sm",children:[h.jsx("thead",{children:(0,h.jsxs)("tr",{className:"text-left",children:[h.jsx("th",{children:(0,m.t)("teachers.name","T\xean")}),h.jsx("th",{children:(0,m.t)("teachers.phone","SĐT")}),h.jsx("th",{children:(0,m.t)("teachers.email","Email")})]})}),h.jsx("tbody",{children:S.map(e=>(0,h.jsxs)("tr",{className:"border-t",children:[h.jsx("td",{className:"py-1",children:e.name}),h.jsx("td",{className:"py-1",children:e.phone}),h.jsx("td",{className:"py-1",children:e.email})]},e.id))})]}),"classes"===f&&(0,h.jsxs)("table",{className:"min-w-full text-sm",children:[h.jsx("thead",{children:(0,h.jsxs)("tr",{className:"text-left",children:[h.jsx("th",{children:(0,m.t)("dashboard.class","Lớp")}),h.jsx("th",{children:(0,m.t)("dashboard.teacher","Gi\xe1o vi\xean")}),h.jsx("th",{children:(0,m.t)("dashboard.students","Học vi\xean")})]})}),h.jsx("tbody",{children:S.map(e=>(0,h.jsxs)("tr",{className:"border-t",children:[h.jsx("td",{className:"py-1",children:getClassLabel(e.id,e)}),h.jsx("td",{className:"py-1",children:e.teacher_name}),h.jsx("td",{className:"py-1",children:e.student_count||""})]},e.id))})]}),"schedules"===f&&(0,h.jsxs)("table",{className:"min-w-full text-sm",children:[h.jsx("thead",{children:(0,h.jsxs)("tr",{className:"text-left",children:[h.jsx("th",{children:(0,m.t)("schedules.col.class","Lớp")}),h.jsx("th",{children:(0,m.t)("schedules.col.weekday","Thứ")}),h.jsx("th",{children:(0,m.t)("schedules.col.start","Bắt đầu")}),h.jsx("th",{children:(0,m.t)("schedules.col.end","Kết th\xfac")})]})}),h.jsx("tbody",{children:S.map(e=>(0,h.jsxs)("tr",{className:"border-t",children:[h.jsx("td",{className:"py-1",children:getClassLabel(e.class_id,e)}),h.jsx("td",{className:"py-1",children:e.weekday}),h.jsx("td",{className:"py-1",children:e.start_time||e.start}),h.jsx("td",{className:"py-1",children:e.end_time||e.end})]},e.id))})]})]})]})})]})}let u=(0,d.l)(a,"default"),p=(0,d.l)(a,"getStaticProps"),j=(0,d.l)(a,"getStaticPaths"),b=(0,d.l)(a,"getServerSideProps"),g=(0,d.l)(a,"config"),N=(0,d.l)(a,"reportWebVitals"),f=(0,d.l)(a,"unstable_getStaticProps"),v=(0,d.l)(a,"unstable_getStaticPaths"),S=(0,d.l)(a,"unstable_getStaticParams"),y=(0,d.l)(a,"unstable_getServerProps"),w=(0,d.l)(a,"unstable_getServerSideProps"),_=new l.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/dashboard",pathname:"/dashboard",bundlePath:"",filename:""},components:{App:n.default,Document:c()},userland:a})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var s=require("../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[761,199,209,450,181],()=>__webpack_exec__(4926));module.exports=t})();