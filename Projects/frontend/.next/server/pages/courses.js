"use strict";(()=>{var e={};e.id=520,e.ids=[520,888,660],e.modules={2064:(e,t,s)=>{s.r(t),s.d(t,{config:()=>j,default:()=>p,getServerSideProps:()=>g,getStaticPaths:()=>b,getStaticProps:()=>x,reportWebVitals:()=>v,routeModule:()=>C,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>N,unstable_getStaticProps:()=>f});var a={};s.r(a),s.d(a,{default:()=>Courses});var l=s(7093),r=s(5244),n=s(1323),i=s(9209),c=s.n(i),o=s(181),d=s(997),u=s(6689),m=s(7871),h=s(6686);function Courses(){let[e,t]=(0,u.useState)([]),[s,a]=(0,u.useState)(!1),[l,r]=(0,u.useState)(null),[n,i]=(0,u.useState)(!1),[c,o]=(0,u.useState)(null),[p,x]=(0,u.useState)({name:"",description:"",level:"",sessions:0,status:"active",tuition_amount:0,discount_percent:0}),[b,g]=(0,u.useState)([]),[j,v]=(0,u.useState)(!1),[f,N]=(0,u.useState)({course_id:null,teacher_id:null,room:"",schedule:"",status:"active"}),[S,y]=(0,u.useState)(""),[w,C]=(0,u.useState)("name"),[_,k]=(0,u.useState)("asc"),[P,E]=(0,u.useState)(""),[T,L]=(0,u.useState)(1),[A,q]=(0,u.useState)(10),[D,O]=(0,u.useState)([]);async function load(){a(!0);try{let e=await (0,h.S)("/api/courses");if(!e.ok)throw Error("Failed to load");let s=await e.json();t(s)}catch(e){r(e.message)}finally{a(!1)}}(0,u.useEffect)(()=>{load()},[]),(0,u.useEffect)(()=>{L(1),O([])},[S,w,_,P,A]);let filteredSorted=()=>{let t=Array.isArray(e)?e.slice():[];if(S){let e=S.toLowerCase();t=t.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.description||"").toLowerCase().includes(e))}return P&&(t=t.filter(e=>(e.status||"")===P)),t.sort((e,t)=>{let s=((e[w]||"")+"").toString().toLowerCase(),a=((t[w]||"")+"").toString().toLowerCase();return s<a?"asc"===_?-1:1:s>a?"asc"===_?1:-1:0}),t},currentPageItems=()=>{let e=filteredSorted(),t=(T-1)*A;return e.slice(t,t+A)},totalPages=()=>Math.max(1,Math.ceil(filteredSorted().length/A));async function handleSave(e){e.preventDefault(),r(null);try{let e;let t={name:p.name,description:p.description,level:p.level,sessions:p.sessions,status:p.status,tuition_amount:Number(p.tuition_amount||0),discount_percent:Number(p.discount_percent||0)};e=c?await (0,h.S)(`/api/courses/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):await (0,h.S)("/api/courses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});let s=await e.json();if(!e.ok)throw Error(s.error||JSON.stringify(s));await load(),i(!1)}catch(e){r(e.message)}}async function editCourse(e){r(null);try{let t=await (0,h.S)(`/api/courses/${e.id}`);if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to fetch course")}let s=await t.json();o(s),x({name:s.name||"",description:s.description||"",level:s.level||"",sessions:s.sessions||0,status:s.status||"active",tuition_amount:s.tuition_amount||0,discount_percent:s.discount_percent||0}),i(!0)}catch(e){r(e.message)}}async function removeCourse(e){if(confirm("X\xe1c nhận x\xf3a kh\xf3a học?"))try{let t=await (0,h.S)(`/api/courses/${e}`,{method:"DELETE"}),s=await t.json();if(!t.ok)throw Error(s.error||JSON.stringify(s));await load()}catch(e){r(e.message)}}async function handleCreateClass(e){e.preventDefault(),r(null);try{let e={course_id:f.course_id,teacher_id:f.teacher_id,room:f.room,schedule:f.schedule,status:f.status},t=await (0,h.S)("/api/classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok)throw Error(s.error||JSON.stringify(s));v(!1)}catch(e){r(e.message)}}return(0,u.useEffect)(()=>{(async function(){try{let e=await (0,h.S)("/api/teachers");if(!e.ok)return;let t=await e.json();g(t)}catch(e){}})()},[]),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h1",{className:"text-2xl font-semibold",children:"Courses"}),d.jsx("div",{children:d.jsx("button",{onClick:function(){o(null),x({name:"",description:"",level:"",sessions:0,status:"active",tuition_amount:0,discount_percent:0}),i(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Add course"})})]}),l&&d.jsx("div",{className:"mb-3 text-red-600",children:l}),n&&(0,d.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[d.jsx("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>i(!1)}),(0,d.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[d.jsx("h2",{className:"text-lg font-semibold mb-3",children:c?"Edit course":"Add course"}),(0,d.jsxs)("form",{onSubmit:handleSave,className:"grid grid-cols-1 gap-3",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Course name"}),d.jsx("input",{value:p.name,onChange:e=>x(t=>({...t,name:e.target.value})),required:!0,className:"p-2 border rounded bg-transparent w-full"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Level"}),d.jsx("input",{value:p.level,onChange:e=>x(t=>({...t,level:e.target.value})),className:"p-2 border rounded bg-transparent w-full"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Sessions"}),d.jsx("input",{type:"number",value:p.sessions,onChange:e=>x(t=>({...t,sessions:parseInt(e.target.value||"0",10)})),className:"p-2 border rounded bg-transparent w-full"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tuition amount"}),d.jsx("input",{type:"text",inputMode:"decimal",value:(0,m.U)(p.tuition_amount),onChange:e=>{let t=(0,m.x)(e.target.value);x(e=>({...e,tuition_amount:t}))},className:"p-2 border rounded bg-transparent w-full",placeholder:"0"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Discount %"}),d.jsx("input",{type:"text",inputMode:"decimal",value:(0,m.x)(p.discount_percent),onChange:e=>x(t=>({...t,discount_percent:(0,m.x)(e.target.value)})),className:"p-2 border rounded bg-transparent w-full",placeholder:"0"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),(0,d.jsxs)("select",{value:p.status,onChange:e=>x(t=>({...t,status:e.target.value})),className:"p-2 border rounded bg-transparent w-full",children:[d.jsx("option",{value:"active",children:"active"}),d.jsx("option",{value:"inactive",children:"inactive"})]})]})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),d.jsx("textarea",{value:p.description,onChange:e=>x(t=>({...t,description:e.target.value})),className:"p-2 border rounded bg-transparent w-full"})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[d.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-3 py-2 border rounded",children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:c?"Update":"Create"})]})]})]})]}),j&&(0,d.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[d.jsx("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>v(!1)}),(0,d.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[d.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Create Class for Course"}),(0,d.jsxs)("form",{onSubmit:handleCreateClass,className:"grid grid-cols-1 gap-3",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Teacher"}),(0,d.jsxs)("select",{value:f.teacher_id||"",onChange:e=>N(t=>({...t,teacher_id:e.target.value})),className:"p-2 border rounded bg-transparent w-full",children:[d.jsx("option",{value:"",children:"-- select teacher --"}),b.map(e=>d.jsx("option",{value:e.id,children:e.name||e.fullname||e.email},e.id))]})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Room"}),d.jsx("input",{value:f.room,onChange:e=>N(t=>({...t,room:e.target.value})),className:"p-2 border rounded bg-transparent w-full"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Schedule"}),d.jsx("input",{value:f.schedule,onChange:e=>N(t=>({...t,schedule:e.target.value})),placeholder:"e.g. Mon/Wed 18:00-20:00",className:"p-2 border rounded bg-transparent w-full"})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),(0,d.jsxs)("select",{value:f.status,onChange:e=>N(t=>({...t,status:e.target.value})),className:"p-2 border rounded bg-transparent w-full",children:[d.jsx("option",{value:"active",children:"active"}),d.jsx("option",{value:"inactive",children:"inactive"})]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[d.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-3 py-2 border rounded",children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:"Create"})]})]})]})]}),d.jsx("div",{className:"bg-white dark:bg-slate-800 p-4 rounded",children:s?d.jsx("div",{children:"Loading..."}):(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx("input",{value:S,onChange:e=>y(e.target.value),placeholder:"Search name/description",className:"p-2 border rounded w-64"}),(0,d.jsxs)("select",{value:w,onChange:e=>C(e.target.value),className:"p-2 border rounded",children:[d.jsx("option",{value:"name",children:"Sort by Name"}),d.jsx("option",{value:"level",children:"Sort by Level"})]}),(0,d.jsxs)("select",{value:_,onChange:e=>k(e.target.value),className:"p-2 border rounded",children:[d.jsx("option",{value:"asc",children:"Asc"}),d.jsx("option",{value:"desc",children:"Desc"})]}),(0,d.jsxs)("select",{value:P,onChange:e=>E(e.target.value),className:"p-2 border rounded",children:[d.jsx("option",{value:"",children:"All statuses"}),d.jsx("option",{value:"active",children:"active"}),d.jsx("option",{value:"inactive",children:"inactive"}),d.jsx("option",{value:"disabled",children:"disabled"})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx("label",{className:"text-sm",children:"Rows:"}),(0,d.jsxs)("select",{value:A,onChange:e=>q(parseInt(e.target.value,10)),className:"p-2 border rounded",children:[d.jsx("option",{value:"5",children:"5"}),d.jsx("option",{value:"10",children:"10"}),d.jsx("option",{value:"25",children:"25"}),d.jsx("option",{value:"50",children:"50"})]})]})]}),(0,d.jsxs)("table",{className:"min-w-full table-auto",children:[d.jsx("thead",{children:(0,d.jsxs)("tr",{className:"text-left",children:[d.jsx("th",{className:"p-2",children:d.jsx("input",{type:"checkbox",onChange:e=>(function(e){let t=currentPageItems().map(e=>e.id);e?O(e=>Array.from(new Set([...e,...t]))):O(e=>e.filter(e=>!t.includes(e)))})(e.target.checked),checked:currentPageItems().every(e=>D.includes(e.id))&&currentPageItems().length>0})}),d.jsx("th",{className:"p-2",children:"No."}),d.jsx("th",{className:"p-2",children:"Name"}),d.jsx("th",{children:"Description"}),d.jsx("th",{children:"Level"}),d.jsx("th",{children:"Sessions"}),d.jsx("th",{children:"Tuition"}),d.jsx("th",{children:"Discount %"}),d.jsx("th",{children:"Status"}),d.jsx("th",{children:"Actions"})]})}),d.jsx("tbody",{children:currentPageItems().map((e,t)=>(0,d.jsxs)("tr",{className:"border-t",children:[d.jsx("td",{className:"p-2",children:d.jsx("input",{type:"checkbox",checked:D.includes(e.id),onChange:t=>O(s=>t.target.checked?Array.from(new Set([...s,e.id])):s.filter(t=>t!==e.id))})}),d.jsx("td",{className:"p-2",children:(T-1)*A+t+1}),d.jsx("td",{className:"p-2",children:e.name}),d.jsx("td",{children:e.description}),d.jsx("td",{children:e.level}),d.jsx("td",{children:e.sessions}),d.jsx("td",{className:"p-2",children:null!=e.tuition_amount?Number(e.tuition_amount).toLocaleString():"-"}),d.jsx("td",{className:"p-2",children:null!=e.discount_percent?Number(e.discount_percent):"-"}),d.jsx("td",{className:"p-2",children:(0,d.jsxs)("select",{value:e.status||"active",onChange:async t=>{let s=t.target.value;try{let t=await (0,h.S)(`/api/courses/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})}),a=await t.json().catch(()=>({}));if(!t.ok)throw Error(a.error||"Failed to update status");await load()}catch(e){r(e.message)}},className:"p-1 border rounded bg-transparent",children:[d.jsx("option",{value:"active",children:"active"}),d.jsx("option",{value:"inactive",children:"inactive"}),d.jsx("option",{value:"disabled",children:"disabled"})]})}),(0,d.jsxs)("td",{className:"p-2",children:[d.jsx("button",{onClick:()=>editCourse(e),className:"mr-2 px-2 py-1 bg-yellow-400 rounded",children:"Edit"}),d.jsx("button",{onClick:()=>{N({course_id:e.id,teacher_id:b.length?b[0].id:null,room:"",schedule:"",status:"active"}),v(!0)},className:"mr-2 px-2 py-1 bg-indigo-600 text-white rounded",children:"Create Class"}),d.jsx("button",{onClick:()=>removeCourse(e.id),className:"px-2 py-1 bg-red-500 text-white rounded",children:"Delete"})]})]},e.id))})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,d.jsxs)("div",{children:[d.jsx("button",{disabled:T<=1,onClick:()=>L(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded mr-2",children:"Prev"}),d.jsx("button",{disabled:T>=totalPages(),onClick:()=>L(e=>Math.min(totalPages(),e+1)),className:"px-2 py-1 border rounded",children:"Next"})]}),(0,d.jsxs)("div",{className:"text-sm",children:["Page ",T," / ",totalPages()," — ",filteredSorted().length," items"]}),d.jsx("div",{children:Array.from({length:totalPages()}).map((e,t)=>d.jsx("button",{onClick:()=>L(t+1),className:`px-2 py-1 border rounded ml-1 ${T===t+1?"bg-slate-200":""}`,children:t+1},t))})]})]})})]})}let p=(0,n.l)(a,"default"),x=(0,n.l)(a,"getStaticProps"),b=(0,n.l)(a,"getStaticPaths"),g=(0,n.l)(a,"getServerSideProps"),j=(0,n.l)(a,"config"),v=(0,n.l)(a,"reportWebVitals"),f=(0,n.l)(a,"unstable_getStaticProps"),N=(0,n.l)(a,"unstable_getStaticPaths"),S=(0,n.l)(a,"unstable_getStaticParams"),y=(0,n.l)(a,"unstable_getServerProps"),w=(0,n.l)(a,"unstable_getServerSideProps"),C=new l.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/courses",pathname:"/courses",bundlePath:"",filename:""},components:{App:o.default,Document:c()},userland:a})},7871:(e,t,s)=>{function sanitizeNumericInput(e){if(null==e)return"";let t=String(e);t=t.replace(/[^0-9.]/g,"");let s=t.split(".");return s.length>2&&(t=s[0]+"."+s.slice(1).join("")),t}function formatWithThousands(e){if(null==e||""===e)return"";let t=String(e).replace(/,/g,"");if(t.indexOf(".")>=0){let[e,s]=t.split("."),a=Number(e||0).toLocaleString();return s?`${a}.${s}`:`${a}.`}return Number(t).toLocaleString()}s.d(t,{U:()=>formatWithThousands,x:()=>sanitizeNumericInput})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[761,199,209,450,181],()=>__webpack_exec__(2064));module.exports=s})();