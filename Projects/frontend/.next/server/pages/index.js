"use strict";(()=>{var e={};e.id=405,e.ids=[405,888,660],e.modules={5556:(e,t,a)=>{a.r(t),a.d(t,{config:()=>j,default:()=>p,getServerSideProps:()=>g,getStaticPaths:()=>x,getStaticProps:()=>m,reportWebVitals:()=>b,routeModule:()=>w,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>N,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>v});var s={};a.r(s),a.d(s,{default:()=>Home});var n=a(7093),r=a(5244),l=a(1323),i=a(9209),d=a.n(i),o=a(181),c=a(997),h=a(6689),u=a(6686);function Home(){let[e,t]=(0,h.useState)([]),[a,s]=(0,h.useState)(null),[n,r]=(0,h.useState)(!1),[l,i]=(0,h.useState)(""),[d,o]=(0,h.useState)("name"),[p,m]=(0,h.useState)("asc"),[x,g]=(0,h.useState)(""),[j,b]=(0,h.useState)(1),[v,f]=(0,h.useState)(10),[S,y]=(0,h.useState)([]),[N,w]=(0,h.useState)(null),[P,C]=(0,h.useState)({name:"",email:"",phone:"",dob:""}),[k,_]=(0,h.useState)(!1),[E,A]=(0,h.useState)([{name:"",email:"",phone:"",relationship:""}]);async function load(){r(!0);try{let e=await (0,u.S)("/api/students");if(!e.ok)throw Error("Failed to load");let a=await e.json();t(a)}catch(e){s(e.message)}finally{r(!1)}}(0,h.useEffect)(()=>{load()},[]),(0,h.useEffect)(()=>{b(1),y([])},[l,d,p,x,v]);let filteredSorted=()=>{let t=Array.isArray(e)?e.slice():[];if(l){let e=l.toLowerCase();t=t.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.email||"").toLowerCase().includes(e)||(t.phone||"").toLowerCase().includes(e))}return x&&(t=t.filter(e=>(e.status||"")===x)),t.sort((e,t)=>{let a=((e[d]||"")+"").toString().toLowerCase(),s=((t[d]||"")+"").toString().toLowerCase();return a<s?"asc"===p?-1:1:a>s?"asc"===p?1:-1:0}),t},currentPageItems=()=>{let e=filteredSorted(),t=(j-1)*v;return e.slice(t,t+v)},totalPages=()=>Math.max(1,Math.ceil(filteredSorted().length/v));async function handleSave(e){e.preventDefault(),s(null);try{let e;let t={name:P.name,email:P.email,phone:P.phone,dob:P.dob,parents:E};e=N?await (0,u.S)(`/api/students/${N.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):await (0,u.S)("/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});let a=await e.json();if(!e.ok)throw Error(a.error||JSON.stringify(a));if(a.student){let e=`Sinh vi\xean tạo th\xe0nh c\xf4ng. T\xe0i khoản: ${a.user.username} (mật khẩu mặc định: ${a.user.username}@123)`;Array.isArray(a.parents)&&a.parents.length>0&&(e+="\nPhụ huynh:\n",a.parents.forEach(t=>{e+=` - ${t.username} (mật khẩu: ${t.password})
`})),alert(e)}await load(),w(null),C({name:"",email:"",phone:"",dob:""}),A([{name:"",email:"",phone:""}]),_(!1)}catch(e){s(e.message)}}async function editStudent(e){s(null);try{let t=await (0,u.S)(`/api/students/${e.id}`);if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to fetch student details")}let a=await t.json();w(a),C({name:a.name||"",email:a.email||"",phone:a.phone||"",dob:a.dob?a.dob.split("T")[0]:""}),a.parents&&Array.isArray(a.parents)&&a.parents.length>0?A(a.parents.map(e=>({id:e.id,user_id:e.user_id,name:e.name||"",email:e.email||"",phone:e.phone||"",relationship:e.relationship||""}))):A([{name:"",email:"",phone:""}]),_(!0)}catch(e){console.error(e),s(e.message)}}async function removeStudent(e){if(confirm("X\xe1c nhận x\xf3a sinh vi\xean?"))try{let t=await (0,u.S)(`/api/students/${e}`,{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error(a.error||JSON.stringify(a));await load()}catch(e){s(e.message)}}return(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h1",{className:"text-2xl font-semibold",children:"Students"}),c.jsx("div",{children:c.jsx("button",{onClick:function(){w(null),C({name:"",email:"",phone:"",dob:""}),A([{name:"",email:"",phone:""}]),_(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Add student"})})]}),a&&c.jsx("div",{className:"mb-3 text-red-600",children:a}),k&&(0,c.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[c.jsx("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>_(!1)}),(0,c.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[c.jsx("h2",{className:"text-lg font-semibold mb-3",children:N?"Edit student":"Add student"}),(0,c.jsxs)("form",{onSubmit:handleSave,className:"grid grid-cols-1 gap-3",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[c.jsx("input",{value:P.name,onChange:e=>C(t=>({...t,name:e.target.value})),required:!0,placeholder:"Student name",className:"p-2 border rounded bg-transparent"}),c.jsx("input",{value:P.email,onChange:e=>C(t=>({...t,email:e.target.value})),placeholder:"Student email",className:"p-2 border rounded bg-transparent"}),c.jsx("input",{value:P.phone,onChange:e=>C(t=>({...t,phone:e.target.value})),placeholder:"Student phone",className:"p-2 border rounded bg-transparent"}),c.jsx("input",{type:"date",value:P.dob,onChange:e=>C(t=>({...t,dob:e.target.value})),className:"p-2 border rounded bg-transparent"})]}),(0,c.jsxs)("div",{className:"mt-4",children:[c.jsx("h3",{className:"font-medium",children:"Parents / Guardians"}),(0,c.jsxs)("div",{className:"space-y-3 mt-2",children:[E.map((e,t)=>(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[c.jsx("input",{value:e.name,onChange:e=>A(a=>{let s=[...a];return s[t]={...s[t],name:e.target.value},s}),placeholder:"Parent name",className:"p-2 border rounded bg-transparent"}),c.jsx("input",{value:e.email,onChange:e=>A(a=>{let s=[...a];return s[t]={...s[t],email:e.target.value},s}),placeholder:"Parent email",className:"p-2 border rounded bg-transparent"}),c.jsx("input",{value:e.phone,onChange:e=>A(a=>{let s=[...a];return s[t]={...s[t],phone:e.target.value},s}),placeholder:"Parent phone",className:"p-2 border rounded bg-transparent"}),(0,c.jsxs)("div",{className:"flex gap-2 items-center min-w-0",children:[(0,c.jsxs)("select",{value:e.relationship||"",onChange:e=>A(a=>{let s=[...a];return s[t]={...s[t],relationship:e.target.value},s}),className:"p-2 border rounded bg-transparent",children:[c.jsx("option",{value:"",children:"Relationship"}),c.jsx("option",{value:"father",children:"Father"}),c.jsx("option",{value:"mother",children:"Mother"}),c.jsx("option",{value:"guardian",children:"Guardian"}),c.jsx("option",{value:"other",children:"Other"})]}),c.jsx("button",{type:"button",onClick:async()=>{if(N&&e&&e.id){if(confirm("X\xe1c nhận x\xf3a phụ huynh? T\xe0i khoản phụ huynh sẽ bị v\xf4 hiệu h\xf3a."))try{let a=await (0,u.S)(`/api/parents/${e.id}`,{method:"DELETE"}),s=await a.json().catch(()=>({}));if(!a.ok)throw Error(s.error||"Failed to remove parent");A(e=>e.filter((e,a)=>a!==t))}catch(e){s(e.message)}}else A(e=>e.filter((e,a)=>a!==t))},title:"Remove parent",className:"h-8 w-8 rounded bg-red-500 text-white flex items-center justify-center shrink-0",children:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[c.jsx("polyline",{points:"3 6 5 6 21 6"}),c.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),c.jsx("path",{d:"M10 11v6"}),c.jsx("path",{d:"M14 11v6"})]})})]})]},t)),c.jsx("div",{children:c.jsx("button",{type:"button",onClick:()=>A(e=>[...e,{name:"",email:"",phone:""}]),className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Add parent"})})]})]}),(0,c.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[c.jsx("button",{type:"button",onClick:()=>_(!1),className:"px-3 py-2 border rounded",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:N?"Update":"Create"})]})]})]})]}),c.jsx("div",{className:"bg-white dark:bg-slate-800 p-4 rounded",children:n?c.jsx("div",{children:"Loading..."}):(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-3",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[c.jsx("input",{value:l,onChange:e=>i(e.target.value),placeholder:"Search name/email/phone",className:"p-2 border rounded w-64"}),(0,c.jsxs)("select",{value:d,onChange:e=>o(e.target.value),className:"p-2 border rounded",children:[c.jsx("option",{value:"name",children:"Sort by Name"}),c.jsx("option",{value:"email",children:"Sort by Email"}),c.jsx("option",{value:"phone",children:"Sort by Phone"})]}),(0,c.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"p-2 border rounded",children:[c.jsx("option",{value:"asc",children:"Asc"}),c.jsx("option",{value:"desc",children:"Desc"})]}),(0,c.jsxs)("select",{value:x,onChange:e=>g(e.target.value),className:"p-2 border rounded",children:[c.jsx("option",{value:"",children:"All statuses"}),c.jsx("option",{value:"active",children:"active"}),c.jsx("option",{value:"inactive",children:"inactive"}),c.jsx("option",{value:"disabled",children:"disabled"})]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[c.jsx("label",{className:"text-sm",children:"Rows:"}),(0,c.jsxs)("select",{value:v,onChange:e=>f(parseInt(e.target.value,10)),className:"p-2 border rounded",children:[c.jsx("option",{value:"5",children:"5"}),c.jsx("option",{value:"10",children:"10"}),c.jsx("option",{value:"25",children:"25"}),c.jsx("option",{value:"50",children:"50"})]})]})]}),(0,c.jsxs)("table",{className:"min-w-full table-auto",children:[c.jsx("thead",{children:(0,c.jsxs)("tr",{className:"text-left",children:[c.jsx("th",{className:"p-2",children:c.jsx("input",{type:"checkbox",onChange:e=>(function(e){let t=currentPageItems().map(e=>e.id);e?y(e=>Array.from(new Set([...e,...t]))):y(e=>e.filter(e=>!t.includes(e)))})(e.target.checked),checked:currentPageItems().every(e=>S.includes(e.id))&&currentPageItems().length>0})}),c.jsx("th",{className:"p-2",children:"No."}),c.jsx("th",{className:"p-2",children:"Name"}),c.jsx("th",{children:"Email"}),c.jsx("th",{children:"Phone"}),c.jsx("th",{children:"DOB"}),c.jsx("th",{children:"Status"}),c.jsx("th",{children:"Actions"})]})}),c.jsx("tbody",{children:currentPageItems().map((e,t)=>(0,c.jsxs)("tr",{className:"border-t",children:[c.jsx("td",{className:"p-2",children:c.jsx("input",{type:"checkbox",checked:S.includes(e.id),onChange:t=>y(a=>t.target.checked?Array.from(new Set([...a,e.id])):a.filter(t=>t!==e.id))})}),c.jsx("td",{className:"p-2",children:(j-1)*v+t+1}),c.jsx("td",{className:"p-2",children:e.name}),c.jsx("td",{children:e.email}),c.jsx("td",{children:e.phone}),c.jsx("td",{children:e.dob?e.dob.split("T")[0]:""}),c.jsx("td",{className:"p-2",children:(0,c.jsxs)("select",{value:e.status||"active",onChange:async t=>{let a=t.target.value;try{let t=await (0,u.S)(`/api/students/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:a})}),s=await t.json().catch(()=>({}));if(!t.ok)throw Error(s.error||"Failed to update status");await load()}catch(e){s(e.message)}},className:"p-1 border rounded bg-transparent",children:[c.jsx("option",{value:"active",children:"active"}),c.jsx("option",{value:"inactive",children:"inactive"}),c.jsx("option",{value:"disabled",children:"disabled"})]})}),(0,c.jsxs)("td",{className:"p-2",children:[c.jsx("button",{onClick:()=>editStudent(e),className:"mr-2 px-2 py-1 bg-yellow-400 rounded",children:"Edit"}),c.jsx("button",{onClick:()=>removeStudent(e.id),className:"px-2 py-1 bg-red-500 text-white rounded",children:"Delete"})]})]},e.id))})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,c.jsxs)("div",{children:[c.jsx("button",{disabled:j<=1,onClick:()=>b(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded mr-2",children:"Prev"}),c.jsx("button",{disabled:j>=totalPages(),onClick:()=>b(e=>Math.min(totalPages(),e+1)),className:"px-2 py-1 border rounded",children:"Next"})]}),(0,c.jsxs)("div",{className:"text-sm",children:["Page ",j," / ",totalPages()," — ",filteredSorted().length," items"]}),c.jsx("div",{children:Array.from({length:totalPages()}).map((e,t)=>c.jsx("button",{onClick:()=>b(t+1),className:`px-2 py-1 border rounded ml-1 ${j===t+1?"bg-slate-200":""}`,children:t+1},t))})]})]})})]})}let p=(0,l.l)(s,"default"),m=(0,l.l)(s,"getStaticProps"),x=(0,l.l)(s,"getStaticPaths"),g=(0,l.l)(s,"getServerSideProps"),j=(0,l.l)(s,"config"),b=(0,l.l)(s,"reportWebVitals"),v=(0,l.l)(s,"unstable_getStaticProps"),f=(0,l.l)(s,"unstable_getStaticPaths"),S=(0,l.l)(s,"unstable_getStaticParams"),y=(0,l.l)(s,"unstable_getServerProps"),N=(0,l.l)(s,"unstable_getServerSideProps"),w=new n.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:o.default,Document:d()},userland:s})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[761,199,209,450,181],()=>__webpack_exec__(5556));module.exports=a})();