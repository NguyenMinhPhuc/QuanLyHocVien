(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{9535:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/teachers",function(){return a(4860)}])},4860:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Teachers}});var s=a(5893),l=a(7294),n=a(6686),i=a(5951);function Teachers(){let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)(!1),[c,d]=(0,l.useState)(null),[o,h]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),[m,p]=(0,l.useState)({name:"",phone:"",email:"",status:"active"}),[g,j]=(0,l.useState)(""),[b,v]=(0,l.useState)("name"),[f,N]=(0,l.useState)("asc"),[w,y]=(0,l.useState)(""),[k,S]=(0,l.useState)(1),[C,T]=(0,l.useState)(10),[E,P]=(0,l.useState)([]);async function load(){r(!0);try{let e=await (0,n.SH)("/api/teachers");if(!e.ok)throw Error("Failed to load");let a=await e.json();t(a)}catch(e){d(e.message)}finally{r(!1)}}(0,l.useEffect)(()=>{load()},[]),(0,l.useEffect)(()=>{S(1),P([])},[g,b,f,w,C]);let filteredSorted=()=>{let t=Array.isArray(e)?e.slice():[];if(g){let e=g.toLowerCase();t=t.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.email||"").toLowerCase().includes(e)||(t.phone||"").toLowerCase().includes(e))}return w&&(t=t.filter(e=>(e.status||"")===w)),t.sort((e,t)=>{let a=((e[b]||"")+"").toString().toLowerCase(),s=((t[b]||"")+"").toString().toLowerCase();return a<s?"asc"===f?-1:1:a>s?"asc"===f?1:-1:0}),t},currentPageItems=()=>{let e=filteredSorted(),t=(k-1)*C;return e.slice(t,t+C)},totalPages=()=>Math.max(1,Math.ceil(filteredSorted().length/C));async function handleSave(e){e.preventDefault(),d(null);try{let e;let t={name:m.name,phone:m.phone,email:m.email,status:m.status};e=u?await (0,n.SH)("/api/teachers/".concat(u.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):await (0,n.SH)("/api/teachers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});let a=await e.json();if(!e.ok)throw Error(a.error||JSON.stringify(a));await load(),h(!1)}catch(e){d(e.message)}}async function editTeacher(e){d(null);try{let t=await (0,n.SH)("/api/teachers/".concat(e.id));if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to fetch teacher")}let a=await t.json();x(a),p({name:a.name||"",phone:a.phone||"",email:a.email||"",status:a.status||"active"}),h(!0)}catch(e){d(e.message)}}async function removeTeacher(e){if(confirm("X\xe1c nhận x\xf3a gi\xe1o vi\xean?"))try{let t=await (0,n.SH)("/api/teachers/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error(a.error||JSON.stringify(a));await load()}catch(e){d(e.message)}}return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:(0,i.t)("teachers.title","Gi\xe1o vi\xean")}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:function(){x(null),p({name:"",phone:"",email:"",status:"active"}),h(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded",children:(0,i.t)("teachers.add","Th\xeam gi\xe1o vi\xean")})})]}),c&&(0,s.jsx)("div",{className:"mb-3 text-red-600",children:c}),o&&(0,s.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>h(!1)}),(0,s.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-3",children:u?(0,i.t)("teachers.edit_title","Sửa gi\xe1o vi\xean"):(0,i.t)("teachers.add_title","Th\xeam gi\xe1o vi\xean")}),(0,s.jsxs)("form",{onSubmit:handleSave,className:"grid grid-cols-1 gap-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,i.t)("teachers.field.name","Họ t\xean")}),(0,s.jsx)("input",{value:m.name,onChange:e=>p(t=>({...t,name:e.target.value})),required:!0,className:"p-2 border rounded bg-transparent w-full text-slate-900 dark:text-slate-100"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,i.t)("teachers.field.phone","SĐT")}),(0,s.jsx)("input",{value:m.phone,onChange:e=>p(t=>({...t,phone:e.target.value})),className:"p-2 border rounded bg-transparent w-full text-slate-900 dark:text-slate-100"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,i.t)("teachers.field.email","Email")}),(0,s.jsx)("input",{type:"email",value:m.email,onChange:e=>p(t=>({...t,email:e.target.value})),className:"p-2 border rounded bg-transparent w-full text-slate-900 dark:text-slate-100"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,i.t)("teachers.field.status","Trạng th\xe1i")}),(0,s.jsxs)("select",{value:m.status,onChange:e=>p(t=>({...t,status:e.target.value})),className:"p-2 border rounded bg-transparent w-full text-slate-900 dark:text-slate-100",children:[(0,s.jsx)("option",{value:"active",children:(0,i.t)("status.active","Hoạt động")}),(0,s.jsx)("option",{value:"inactive",children:(0,i.t)("status.inactive","Kh\xf4ng hoạt động")})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>h(!1),className:"px-3 py-2 border rounded",children:(0,i.t)("actions.cancel","Hủy")}),(0,s.jsx)("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:u?(0,i.t)("actions.update","Cập nhật"):(0,i.t)("actions.create","Tạo")})]})]})]})]}),(0,s.jsx)("div",{className:"bg-white dark:bg-slate-800 p-4 rounded",children:a?(0,s.jsx)("div",{children:"Loading..."}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative w-64",children:[(0,s.jsx)("input",{value:g,onChange:e=>j(e.target.value),placeholder:(0,i.t)("teachers.search.placeholder","T\xecm theo t\xean/email/sđt"),className:"p-2 pr-8 border rounded w-full bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),g&&(0,s.jsx)("button",{onClick:()=>j(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700",children:"\xd7"})]}),(0,s.jsxs)("select",{value:b,onChange:e=>v(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[(0,s.jsx)("option",{value:"name",children:(0,i.t)("teachers.sort.name","Sắp theo t\xean")}),(0,s.jsx)("option",{value:"email",children:(0,i.t)("teachers.sort.email","Sắp theo email")}),(0,s.jsx)("option",{value:"phone",children:(0,i.t)("teachers.sort.phone","Sắp theo sđt")})]}),(0,s.jsxs)("select",{value:f,onChange:e=>N(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[(0,s.jsx)("option",{value:"asc",children:(0,i.t)("sort.asc","Tăng dần")}),(0,s.jsx)("option",{value:"desc",children:(0,i.t)("sort.desc","Giảm dần")})]}),(0,s.jsxs)("select",{value:w,onChange:e=>y(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[(0,s.jsx)("option",{value:"",children:(0,i.t)("teachers.filter.all","Tất cả trạng th\xe1i")}),(0,s.jsx)("option",{value:"active",children:(0,i.t)("status.active","Hoạt động")}),(0,s.jsx)("option",{value:"inactive",children:(0,i.t)("status.inactive","Kh\xf4ng hoạt động")}),(0,s.jsx)("option",{value:"disabled",children:(0,i.t)("status.disabled","V\xf4 hiệu")})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-sm",children:(0,i.t)("teachers.rows","Số h\xe0ng:")}),(0,s.jsxs)("select",{value:C,onChange:e=>T(parseInt(e.target.value,10)),className:"p-2 border rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[(0,s.jsx)("option",{value:"5",children:"5"}),(0,s.jsx)("option",{value:"10",children:"10"}),(0,s.jsx)("option",{value:"25",children:"25"}),(0,s.jsx)("option",{value:"50",children:"50"})]})]})]}),(0,s.jsxs)("table",{className:"min-w-full table-auto",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left",children:[(0,s.jsx)("th",{className:"p-2",children:(0,s.jsx)("input",{type:"checkbox",onChange:e=>(function(e){let t=currentPageItems().map(e=>e.id);e?P(e=>Array.from(new Set([...e,...t]))):P(e=>e.filter(e=>!t.includes(e)))})(e.target.checked),checked:currentPageItems().every(e=>E.includes(e.id))&&currentPageItems().length>0})}),(0,s.jsx)("th",{className:"p-2",children:(0,i.t)("teachers.table.no","STT")}),(0,s.jsx)("th",{className:"p-2",children:(0,i.t)("teachers.table.name","Họ t\xean")}),(0,s.jsx)("th",{children:(0,i.t)("teachers.table.phone","SĐT")}),(0,s.jsx)("th",{children:(0,i.t)("teachers.table.email","Email")}),(0,s.jsx)("th",{children:(0,i.t)("teachers.table.status","Trạng th\xe1i")}),(0,s.jsx)("th",{children:(0,i.t)("teachers.table.actions","H\xe0nh động")})]})}),(0,s.jsx)("tbody",{children:currentPageItems().map((e,t)=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("input",{type:"checkbox",checked:E.includes(e.id),onChange:t=>P(a=>t.target.checked?Array.from(new Set([...a,e.id])):a.filter(t=>t!==e.id))})}),(0,s.jsx)("td",{className:"p-2",children:(k-1)*C+t+1}),(0,s.jsx)("td",{className:"p-2",children:e.name}),(0,s.jsx)("td",{children:e.phone}),(0,s.jsx)("td",{children:e.email}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsxs)("select",{value:e.status||"active",onChange:async t=>{let a=t.target.value;try{let t=await (0,n.SH)("/api/teachers/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:a})}),s=await t.json().catch(()=>({}));if(!t.ok)throw Error(s.error||"Failed to update status");await load()}catch(e){d(e.message)}},className:"p-1 border rounded bg-transparent",children:[(0,s.jsx)("option",{value:"active",children:(0,i.t)("status.active","Hoạt động")}),(0,s.jsx)("option",{value:"inactive",children:(0,i.t)("status.inactive","Kh\xf4ng hoạt động")}),(0,s.jsx)("option",{value:"disabled",children:(0,i.t)("status.disabled","V\xf4 hiệu")})]})}),(0,s.jsxs)("td",{className:"p-2",children:[(0,s.jsx)("button",{onClick:()=>editTeacher(e),className:"mr-2 px-2 py-1 bg-yellow-400 rounded",children:(0,i.t)("actions.edit","Sửa")}),(0,s.jsx)("button",{onClick:()=>removeTeacher(e.id),className:"px-2 py-1 bg-red-500 text-white rounded",children:(0,i.t)("actions.delete","X\xf3a")})]})]},e.id))})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{disabled:k<=1,onClick:()=>S(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded mr-2",children:"Prev"}),(0,s.jsx)("button",{disabled:k>=totalPages(),onClick:()=>S(e=>Math.min(totalPages(),e+1)),className:"px-2 py-1 border rounded",children:"Next"})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Page ",k," / ",totalPages()," — ",filteredSorted().length," items"]}),(0,s.jsx)("div",{children:Array.from({length:totalPages()}).map((e,t)=>(0,s.jsx)("button",{onClick:()=>S(t+1),className:"px-2 py-1 border rounded ml-1 ".concat(k===t+1?"bg-slate-200":""),children:t+1},t))})]})]})})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9535)}),_N_E=e.O()}]);