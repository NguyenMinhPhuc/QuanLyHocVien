(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{4820:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/courses",function(){return s(3452)}])},7871:function(e,t,s){"use strict";function sanitizeNumericInput(e){if(null==e)return"";let t=String(e);t=t.replace(/[^0-9.]/g,"");let s=t.split(".");return s.length>2&&(t=s[0]+"."+s.slice(1).join("")),t}function formatWithThousands(e){if(null==e||""===e)return"";let t=String(e).replace(/,/g,"");if(t.indexOf(".")>=0){let[e,s]=t.split("."),a=Number(e||0).toLocaleString();return s?"".concat(a,".").concat(s):"".concat(a,".")}return Number(t).toLocaleString()}s.d(t,{U:function(){return formatWithThousands},x:function(){return sanitizeNumericInput}})},3452:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Courses}});var a=s(5893),l=s(7294),r=s(7219),n=s(7871),i=s(6686),c=s(5951);function Courses(){let[e,t]=(0,l.useState)([]),[s,o]=(0,l.useState)(!1),[d,u]=(0,l.useState)(null),[h,x]=(0,l.useState)(!1),[m,p]=(0,l.useState)(null),[b,g]=(0,l.useState)({name:"",description:"",level:"",sessions:0,status:"active",tuition_amount:0,discount_percent:0}),[j,f]=(0,l.useState)([]),[v,N]=(0,l.useState)(!1),[k,w]=(0,l.useState)({course_id:null,teacher_id:null,room:"",schedule:"",status:"active"}),[y,S]=(0,l.useState)(""),[C,_]=(0,l.useState)("name"),[T,P]=(0,l.useState)("asc"),[E,H]=(0,l.useState)(""),[O,L]=(0,l.useState)(1),[I,M]=(0,l.useState)(10),[J,z]=(0,l.useState)([]);async function load(){o(!0);try{let e=await (0,i.SH)("/api/courses");if(!e.ok)throw Error("Failed to load");let s=await e.json();t(s)}catch(e){u(e.message)}finally{o(!1)}}(0,l.useEffect)(()=>{load()},[]),(0,l.useEffect)(()=>{L(1),z([])},[y,C,T,E,I]);let filteredSorted=()=>{let t=Array.isArray(e)?e.slice():[];if(y){let e=y.toLowerCase();t=t.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.description||"").toLowerCase().includes(e))}return E&&(t=t.filter(e=>(e.status||"")===E)),t.sort((e,t)=>{let s=((e[C]||"")+"").toString().toLowerCase(),a=((t[C]||"")+"").toString().toLowerCase();return s<a?"asc"===T?-1:1:s>a?"asc"===T?1:-1:0}),t},currentPageItems=()=>{let e=filteredSorted(),t=(O-1)*I;return e.slice(t,t+I)},totalPages=()=>Math.max(1,Math.ceil(filteredSorted().length/I));async function handleSave(e){e.preventDefault(),u(null);try{let e;let t={name:b.name,description:b.description,level:b.level,sessions:b.sessions,status:b.status,tuition_amount:Number(b.tuition_amount||0),discount_percent:Number(b.discount_percent||0)};e=m?await (0,i.SH)("/api/courses/".concat(m.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):await (0,i.SH)("/api/courses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});let s=await e.json();if(!e.ok)throw Error(s.error||JSON.stringify(s));await load(),x(!1)}catch(e){u(e.message)}}async function editCourse(e){u(null);try{let t=await (0,i.SH)("/api/courses/".concat(e.id));if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to fetch course")}let s=await t.json();p(s),g({name:s.name||"",description:s.description||"",level:s.level||"",sessions:s.sessions||0,status:s.status||"active",tuition_amount:s.tuition_amount||0,discount_percent:s.discount_percent||0}),x(!0)}catch(e){u(e.message)}}async function removeCourse(e){if(confirm("X\xe1c nhận x\xf3a kh\xf3a học?"))try{let t=await (0,i.SH)("/api/courses/".concat(e),{method:"DELETE"}),s=await t.json();if(!t.ok)throw Error(s.error||JSON.stringify(s));await load()}catch(e){u(e.message)}}async function handleCreateClass(e){e.preventDefault(),u(null);try{let e={course_id:k.course_id,teacher_id:k.teacher_id,room:k.room,schedule:k.schedule,status:k.status},t=await (0,i.SH)("/api/classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok)throw Error(s.error||JSON.stringify(s));N(!1)}catch(e){u(e.message)}}return(0,l.useEffect)(()=>{!async function(){try{let e=await (0,i.SH)("/api/teachers");if(!e.ok)return;let t=await e.json();f(t)}catch(e){}}()},[]),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:(0,c.t)("courses.title","Kh\xf3a học")}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:function(){p(null),g({name:"",description:"",level:"",sessions:0,status:"active",tuition_amount:0,discount_percent:0}),x(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded",children:(0,c.t)("courses.add","Th\xeam kh\xf3a học")})})]}),d&&(0,a.jsx)("div",{className:"mb-3 text-red-600",children:d}),h&&(0,a.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>x(!1)}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-3",children:m?(0,c.t)("courses.edit_title","Sửa kh\xf3a học"):(0,c.t)("courses.add_title","Th\xeam kh\xf3a học")}),(0,a.jsxs)("form",{onSubmit:handleSave,className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.name","T\xean kh\xf3a học")}),(0,a.jsx)("input",{value:b.name,onChange:e=>g(t=>({...t,name:e.target.value})),required:!0,className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.level","Tr\xecnh độ")}),(0,a.jsx)("input",{value:b.level,onChange:e=>g(t=>({...t,level:e.target.value})),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.sessions","Số buổi")}),(0,a.jsx)("input",{type:"number",value:b.sessions,onChange:e=>g(t=>({...t,sessions:parseInt(e.target.value||"0",10)})),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.tuition","Học ph\xed")}),(0,a.jsx)("input",{type:"text",inputMode:"decimal",value:b.tuition_amount,onChange:e=>{let t=(0,n.x)(e.target.value);g(e=>({...e,tuition_amount:t}))},className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full",placeholder:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.discount","Giảm gi\xe1 %")}),(0,a.jsx)("input",{type:"text",inputMode:"decimal",value:(0,n.x)(b.discount_percent),onChange:e=>g(t=>({...t,discount_percent:(0,n.x)(e.target.value)})),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full",placeholder:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.status","Trạng th\xe1i")}),(0,a.jsxs)("select",{value:b.status,onChange:e=>g(t=>({...t,status:e.target.value})),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full",children:[(0,a.jsx)("option",{value:"active",children:"active"}),(0,a.jsx)("option",{value:"inactive",children:"inactive"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("courses.field.description","M\xf4 tả")}),(0,a.jsx)("textarea",{value:b.description,onChange:e=>g(t=>({...t,description:e.target.value})),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600 w-full"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>x(!1),className:"px-3 py-2 border rounded",children:(0,c.t)("actions.cancel","Hủy")}),(0,a.jsx)("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:m?(0,c.t)("actions.update","Cập nhật"):(0,c.t)("actions.create","Tạo")})]})]})]})]}),v&&(0,a.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>N(!1)}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-3",children:(0,c.t)("classes.create_for_course","Tạo lớp cho kh\xf3a học")}),(0,a.jsxs)("form",{onSubmit:handleCreateClass,className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("classes.field.teacher","Gi\xe1o vi\xean")}),(0,a.jsxs)("select",{value:k.teacher_id||"",onChange:e=>w(t=>({...t,teacher_id:e.target.value})),className:"p-2 border rounded bg-transparent w-full",children:[(0,a.jsx)("option",{value:"",children:"-- select teacher --"}),j.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name||e.fullname||e.email},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("classes.field.room","Ph\xf2ng")}),(0,a.jsx)("input",{value:k.room,onChange:e=>w(t=>({...t,room:e.target.value})),className:"p-2 border rounded bg-transparent w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("classes.field.schedule","Lịch")}),(0,a.jsx)("input",{value:k.schedule,onChange:e=>w(t=>({...t,schedule:e.target.value})),placeholder:"e.g. Mon/Wed 18:00-20:00",className:"p-2 border rounded bg-transparent w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:(0,c.t)("classes.field.status","Trạng th\xe1i")}),(0,a.jsxs)("select",{value:k.status,onChange:e=>w(t=>({...t,status:e.target.value})),className:"p-2 border rounded bg-transparent w-full",children:[(0,a.jsx)("option",{value:"active",children:"active"}),(0,a.jsx)("option",{value:"inactive",children:"inactive"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>N(!1),className:"px-3 py-2 border rounded",children:(0,c.t)("actions.cancel","Hủy")}),(0,a.jsx)("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:(0,c.t)("actions.create","Tạo")})]})]})]})]}),(0,a.jsx)("div",{className:"bg-white dark:bg-slate-800 p-4 rounded",children:s?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative w-64",children:[(0,a.jsx)("input",{value:y,onChange:e=>S(e.target.value),placeholder:(0,c.t)("courses.search.placeholder","T\xecm kiếm t\xean/m\xf4 tả"),className:"p-2 pr-8 border rounded w-full bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600"}),y&&(0,a.jsx)("button",{onClick:()=>S(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700",children:"\xd7"})]}),(0,a.jsxs)("select",{value:C,onChange:e=>_(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,a.jsx)("option",{value:"name",children:(0,c.t)("courses.sort.name","Sắp theo t\xean")}),(0,a.jsx)("option",{value:"level",children:(0,c.t)("courses.sort.level","Sắp theo tr\xecnh độ")})]}),(0,a.jsxs)("select",{value:T,onChange:e=>P(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,a.jsx)("option",{value:"asc",children:(0,c.t)("sort.asc","Tăng dần")}),(0,a.jsx)("option",{value:"desc",children:(0,c.t)("sort.desc","Giảm dần")})]}),(0,a.jsxs)("select",{value:E,onChange:e=>H(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,a.jsx)("option",{value:"",children:(0,c.t)("courses.filter.all","Tất cả trạng th\xe1i")}),(0,a.jsx)("option",{value:"active",children:(0,c.t)("status.active","Hoạt động")}),(0,a.jsx)("option",{value:"inactive",children:(0,c.t)("status.inactive","Kh\xf4ng hoạt động")}),(0,a.jsx)("option",{value:"disabled",children:(0,c.t)("status.disabled","V\xf4 hiệu")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm",children:(0,c.t)("courses.rows","Số h\xe0ng:")}),(0,a.jsxs)("select",{value:I,onChange:e=>M(parseInt(e.target.value,10)),className:"p-2 border rounded",children:[(0,a.jsx)("option",{value:"5",children:"5"}),(0,a.jsx)("option",{value:"10",children:"10"}),(0,a.jsx)("option",{value:"25",children:"25"}),(0,a.jsx)("option",{value:"50",children:"50"})]})]})]}),(0,a.jsxs)("table",{className:"min-w-full table-auto",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{className:"p-2",children:(0,a.jsx)("input",{type:"checkbox",onChange:e=>(function(e){let t=currentPageItems().map(e=>e.id);e?z(e=>Array.from(new Set([...e,...t]))):z(e=>e.filter(e=>!t.includes(e)))})(e.target.checked),checked:currentPageItems().every(e=>J.includes(e.id))&&currentPageItems().length>0})}),(0,a.jsx)("th",{className:"p-2",children:(0,c.t)("courses.table.no","STT")}),(0,a.jsx)("th",{className:"p-2",children:(0,c.t)("courses.table.name","T\xean")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.description","M\xf4 tả")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.level","Tr\xecnh độ")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.sessions","Số buổi")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.tuition","Học ph\xed")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.discount","Giảm %")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.status","Trạng th\xe1i")}),(0,a.jsx)("th",{children:(0,c.t)("courses.table.actions","H\xe0nh động")})]})}),(0,a.jsx)("tbody",{children:currentPageItems().map((e,t)=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{type:"checkbox",checked:J.includes(e.id),onChange:t=>z(s=>t.target.checked?Array.from(new Set([...s,e.id])):s.filter(t=>t!==e.id))})}),(0,a.jsx)("td",{className:"p-2",children:(O-1)*I+t+1}),(0,a.jsx)("td",{className:"p-2",children:e.name}),(0,a.jsx)("td",{children:e.description}),(0,a.jsx)("td",{children:e.level}),(0,a.jsx)("td",{children:e.sessions}),(0,a.jsx)("td",{className:"p-2",children:null!=e.tuition_amount?Number(e.tuition_amount).toLocaleString():"-"}),(0,a.jsx)("td",{className:"p-2",children:null!=e.discount_percent?Number(e.discount_percent):"-"}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("button",{title:e.status||"active",onClick:async()=>{let t=e.status||"active";try{let s=await (0,i.SH)("/api/courses/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"active"===t?"inactive":"active"})}),a=await s.json().catch(()=>({}));if(!s.ok)throw Error(a.error||"Failed to update status");await load()}catch(e){u(e.message)}},className:"p-1 rounded",children:"active"===(e.status||"active")?(0,a.jsx)(r._rq,{className:"text-green-600"}):"disabled"===e.status?(0,a.jsx)(r.BJv,{className:"text-yellow-500"}):(0,a.jsx)(r.B0P,{className:"text-gray-500"})})}),(0,a.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>editCourse(e),title:(0,c.t)("actions.edit","Sửa"),className:"p-2 rounded bg-yellow-400 hover:opacity-90",children:(0,a.jsx)(r.vPQ,{})}),(0,a.jsx)("button",{onClick:()=>{w({course_id:e.id,teacher_id:j.length?j[0].id:null,room:"",schedule:"",status:"active"}),N(!0)},title:(0,c.t)("courses.create_class","Tạo lớp"),className:"p-2 rounded bg-indigo-600 text-white hover:opacity-90",children:(0,a.jsx)(r.xVi,{})}),(0,a.jsx)("button",{onClick:()=>removeCourse(e.id),title:(0,c.t)("actions.delete","X\xf3a"),className:"p-2 rounded bg-red-500 text-white hover:opacity-90",children:(0,a.jsx)(r.Ybf,{})})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{disabled:O<=1,onClick:()=>L(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded mr-2",children:"Prev"}),(0,a.jsx)("button",{disabled:O>=totalPages(),onClick:()=>L(e=>Math.min(totalPages(),e+1)),className:"px-2 py-1 border rounded",children:"Next"})]}),(0,a.jsxs)("div",{className:"text-sm",children:["Page ",O," / ",totalPages()," — ",filteredSorted().length," items"]}),(0,a.jsx)("div",{children:Array.from({length:totalPages()}).map((e,t)=>(0,a.jsx)("button",{onClick:()=>L(t+1),className:"px-2 py-1 border rounded ml-1 ".concat(O===t+1?"bg-slate-200":""),children:t+1},t))})]})]})})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4820)}),_N_E=e.O()}]);