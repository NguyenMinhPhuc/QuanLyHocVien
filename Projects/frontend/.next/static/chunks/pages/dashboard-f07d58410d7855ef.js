(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{1075:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(3599)}])},3599:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return DashboardPage}});var a=t(5893),l=t(7294),d=t(6686),r=t(5951);function DashboardPage(){let[e,s]=(0,l.useState)(null),[t,c]=(0,l.useState)(!1),[i,n]=(0,l.useState)(null);async function load(){c(!0);try{let e=await (0,d.SH)("/api/dashboard");if(!e.ok)throw Error("Failed");let t=await e.json();s(t)}catch(e){n(e.message)}finally{c(!1)}}(0,l.useEffect)(()=>{load()},[]);let[h,o]=(0,l.useState)([]),[x,m]=(0,l.useState)(new Date().getFullYear()),[u,j]=(0,l.useState)(""),[p,b]=(0,l.useState)(null),[N,f]=(0,l.useState)(!1),[g,y]=(0,l.useState)(""),[v,w]=(0,l.useState)([]),[k,S]=(0,l.useState)(!1);async function openDetail(e){y(e),f(!0),S(!0),w([]);try{let s="";"students"===e?s="/api/students?limit=200":"teachers"===e?s="/api/teachers?limit=200":"classes"===e?s="/api/classes":"schedules"===e&&(s="/api/schedules?page=1&pageSize=200");let t=await (0,d.SH)(s);if(!t.ok)throw Error("Failed");let a=await t.json(),l=a.rows||a;w(l||[])}catch(e){console.error("[dashboard] openDetail error",e.message),w([])}finally{S(!1)}}function getClassLabel(e,s){if(!e&&s)return s.name||s.course_name||s.class_name||"Class "+(s.id||"");let t=h.find(s=>String(s.id)===String(e));return t?t.name||t.course_name||"Class "+t.id:"Class "+e}(0,l.useEffect)(()=>{load()},[]),(0,l.useEffect)(()=>{(0,d.SH)("/api/classes").then(e=>e.ok?e.json():[]).then(o).catch(()=>o([]))},[]),(0,l.useEffect)(()=>{(async function(){try{let e=new URLSearchParams({year:String(x)});u&&e.set("classId",u);let s=await (0,d.SH)("/api/dashboard/revenue?"+e.toString());if(!s.ok)throw Error("Failed");let t=await s.json();b(t.rows)}catch(e){}})()},[x,u]);let _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:(0,r.t)("dashboard.title","Dashboard")}),i&&(0,a.jsx)("div",{className:"text-red-600 mb-2",children:i}),t&&(0,a.jsx)("div",{children:(0,r.t)("actions.loading","Đang tải...")}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 rounded shadow bg-indigo-600 text-white",children:[(0,a.jsx)("div",{className:"text-sm opacity-80",children:(0,r.t)("dashboard.total_students","Tổng học vi\xean")}),(0,a.jsx)("div",{onClick:()=>openDetail("students"),className:"text-3xl font-bold cursor-pointer",children:e.totalStudents})]}),(0,a.jsxs)("div",{className:"p-4 rounded shadow bg-emerald-600 text-white",children:[(0,a.jsx)("div",{className:"text-sm opacity-80",children:(0,r.t)("dashboard.total_teachers","Tổng gi\xe1o vi\xean")}),(0,a.jsx)("div",{onClick:()=>openDetail("teachers"),className:"text-3xl font-bold cursor-pointer",children:e.totalTeachers})]}),(0,a.jsxs)("div",{className:"p-4 rounded shadow bg-amber-500 text-white",children:[(0,a.jsx)("div",{className:"text-sm opacity-80",children:(0,r.t)("dashboard.total_classes","Tổng lớp")}),(0,a.jsxs)("div",{onClick:()=>openDetail("classes"),className:"text-3xl font-bold cursor-pointer",children:[e.totalClasses," ",(0,a.jsxs)("span",{className:"text-sm opacity-80",children:["(",(0,r.t)("dashboard.active","Hoạt động"),": ",e.activeClasses,")"]})]})]}),(0,a.jsxs)("div",{className:"p-4 rounded shadow bg-rose-600 text-white",children:[(0,a.jsx)("div",{className:"text-sm opacity-80",children:(0,r.t)("dashboard.schedules","Lịch")}),(0,a.jsxs)("div",{onClick:()=>openDetail("schedules"),className:"text-3xl font-bold cursor-pointer",children:[e.upcomingSessions," ",(0,a.jsx)("span",{className:"text-sm opacity-80",children:(0,r.t)("dashboard.upcoming","Sắp tới")})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-white dark:bg-slate-800 rounded shadow text-slate-700 dark:text-slate-100",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:(0,r.t)("dashboard.revenue","Doanh thu học ph\xed theo th\xe1ng")}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("select",{value:x,onChange:e=>m(Number(e.target.value)),className:"border px-2 py-1 rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:Array.from({length:5}).map((e,s)=>{let t=new Date().getFullYear()-s;return(0,a.jsx)("option",{value:t,children:t},t)})}),(0,a.jsxs)("select",{value:u,onChange:e=>j(e.target.value),className:"border px-2 py-1 rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,a.jsx)("option",{value:"",children:(0,r.t)("dashboard.all_classes","Tất cả lớp")}),h.map(e=>(0,a.jsx)("option",{value:String(e.id),children:e.name||e.id},e.id))]})]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("svg",{width:"100%",height:"240",viewBox:"0 0 800 240",children:[(p||[]).map((e,s)=>{let t=Math.max(...(p||[]).map(e=>e.total||0),1),l=40+56*s,d=Math.round((e.total||0)/t*160),r=200-d;return(0,a.jsxs)("g",{children:[(0,a.jsx)("rect",{x:l,y:r,width:40,height:d,rx:"4",fill:"#60a5fa"}),(0,a.jsx)("text",{x:l+20,y:216,fontSize:"12",fill:"currentColor",fillOpacity:"0.8",textAnchor:"middle",children:_[s]}),(0,a.jsx)("text",{x:l+20,y:r-6,fontSize:"11",fill:"currentColor",fillOpacity:"1",textAnchor:"middle",children:(e.total||0).toLocaleString()})]},s)}),(0,a.jsx)("line",{x1:"32",y1:"200",x2:"760",y2:"200",stroke:"currentColor",strokeWidth:"1",strokeOpacity:"0.15"})]})})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-white dark:bg-slate-800 rounded shadow text-slate-700 dark:text-slate-100",children:[(0,a.jsx)("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:(0,r.t)("dashboard.top_classes","Lớp đ\xf4ng nhất")}),(0,a.jsx)("div",{children:(0,a.jsxs)("table",{className:"min-w-full mt-2 text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left",children:(0,r.t)("dashboard.class","Lớp")}),(0,a.jsx)("th",{className:"text-left",children:(0,r.t)("dashboard.teacher","Gi\xe1o vi\xean")}),(0,a.jsx)("th",{className:"text-right",children:(0,r.t)("dashboard.students","Học vi\xean")})]})}),(0,a.jsx)("tbody",{children:(e.topClasses||[]).map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-1",children:e.course_name||"Class "+e.id}),(0,a.jsx)("td",{className:"py-1",children:e.teacher_name||"-"}),(0,a.jsx)("td",{className:"py-1 text-right",children:e.student_count||0})]},e.id))})]})})]})]}),N&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-11/12 md:w-3/4 max-h-[80vh] overflow-auto p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"students"===g?(0,r.t)("dashboard.students","Học vi\xean"):"teachers"===g?(0,r.t)("dashboard.teachers","Gi\xe1o vi\xean"):"classes"===g?(0,r.t)("dashboard.classes","Lớp"):(0,r.t)("dashboard.schedules","Lịch")}),(0,a.jsx)("button",{className:"text-sm px-3 py-1 rounded border",onClick:()=>f(!1),children:(0,r.t)("actions.close","Đ\xf3ng")})]}),k&&(0,a.jsx)("div",{children:(0,r.t)("actions.loading","Đang tải...")}),!k&&(0,a.jsxs)("div",{children:["students"===g&&(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{children:(0,r.t)("students.name","T\xean")}),(0,a.jsx)("th",{children:(0,r.t)("students.phone","SĐT")}),(0,a.jsx)("th",{children:(0,r.t)("students.email","Email")})]})}),(0,a.jsx)("tbody",{children:v.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-1",children:e.name}),(0,a.jsx)("td",{className:"py-1",children:e.phone}),(0,a.jsx)("td",{className:"py-1",children:e.email})]},e.id))})]}),"teachers"===g&&(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{children:(0,r.t)("teachers.name","T\xean")}),(0,a.jsx)("th",{children:(0,r.t)("teachers.phone","SĐT")}),(0,a.jsx)("th",{children:(0,r.t)("teachers.email","Email")})]})}),(0,a.jsx)("tbody",{children:v.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-1",children:e.name}),(0,a.jsx)("td",{className:"py-1",children:e.phone}),(0,a.jsx)("td",{className:"py-1",children:e.email})]},e.id))})]}),"classes"===g&&(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{children:(0,r.t)("dashboard.class","Lớp")}),(0,a.jsx)("th",{children:(0,r.t)("dashboard.teacher","Gi\xe1o vi\xean")}),(0,a.jsx)("th",{children:(0,r.t)("dashboard.students","Học vi\xean")})]})}),(0,a.jsx)("tbody",{children:v.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-1",children:getClassLabel(e.id,e)}),(0,a.jsx)("td",{className:"py-1",children:e.teacher_name}),(0,a.jsx)("td",{className:"py-1",children:e.student_count||""})]},e.id))})]}),"schedules"===g&&(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{children:(0,r.t)("schedules.col.class","Lớp")}),(0,a.jsx)("th",{children:(0,r.t)("schedules.col.weekday","Thứ")}),(0,a.jsx)("th",{children:(0,r.t)("schedules.col.start","Bắt đầu")}),(0,a.jsx)("th",{children:(0,r.t)("schedules.col.end","Kết th\xfac")})]})}),(0,a.jsx)("tbody",{children:v.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-1",children:getClassLabel(e.class_id,e)}),(0,a.jsx)("td",{className:"py-1",children:e.weekday}),(0,a.jsx)("td",{className:"py-1",children:e.start_time||e.start}),(0,a.jsx)("td",{className:"py-1",children:e.end_time||e.end})]},e.id))})]})]})]})})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=1075)}),_N_E=e.O()}]);