(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7052)}])},7052:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var s=a(5893),n=a(7294),r=a(6686),l=a(7219),d=a(5951);function Home(){let[e,t]=(0,n.useState)([]),[a,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),[h,u]=(0,n.useState)(""),[p,m]=(0,n.useState)("name"),[x,b]=(0,n.useState)("asc"),[g,j]=(0,n.useState)(""),[v,f]=(0,n.useState)(1),[k,y]=(0,n.useState)(10),[N,w]=(0,n.useState)([]),[S,C]=(0,n.useState)(null),[E,P]=(0,n.useState)({name:"",email:"",phone:"",dob:""}),[T,H]=(0,n.useState)(!1),[_,L]=(0,n.useState)([{name:"",email:"",phone:"",relationship:""}]);async function load(){c(!0);try{let e=await (0,r.SH)("/api/students");if(!e.ok)throw Error("Failed to load");let a=await e.json();t(a)}catch(e){i(e.message)}finally{c(!1)}}(0,n.useEffect)(()=>{load()},[]),(0,n.useEffect)(()=>{f(1),w([])},[h,p,x,g,k]);let filteredSorted=()=>{let t=Array.isArray(e)?e.slice():[];if(h){let e=h.toLowerCase();t=t.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.email||"").toLowerCase().includes(e)||(t.phone||"").toLowerCase().includes(e))}return g&&(t=t.filter(e=>(e.status||"")===g)),t.sort((e,t)=>{let a=((e[p]||"")+"").toString().toLowerCase(),s=((t[p]||"")+"").toString().toLowerCase();return a<s?"asc"===x?-1:1:a>s?"asc"===x?1:-1:0}),t},currentPageItems=()=>{let e=filteredSorted(),t=(v-1)*k;return e.slice(t,t+k)},totalPages=()=>Math.max(1,Math.ceil(filteredSorted().length/k));async function handleSave(e){e.preventDefault(),i(null);try{let e;let t={name:E.name,email:E.email,phone:E.phone,dob:E.dob,parents:_};e=S?await (0,r.SH)("/api/students/".concat(S.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):await (0,r.SH)("/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});let a=await e.json();if(!e.ok)throw Error(a.error||JSON.stringify(a));if(a.student){let e="Sinh vi\xean tạo th\xe0nh c\xf4ng. T\xe0i khoản: ".concat(a.user.username," (mật khẩu mặc định: ").concat(a.user.username,"@123)");Array.isArray(a.parents)&&a.parents.length>0&&(e+="\nPhụ huynh:\n",a.parents.forEach(t=>{e+=" - ".concat(t.username," (mật khẩu: ").concat(t.password,")\n")})),alert(e)}await load(),C(null),P({name:"",email:"",phone:"",dob:""}),L([{name:"",email:"",phone:""}]),H(!1)}catch(e){i(e.message)}}async function editStudent(e){i(null);try{let t=await (0,r.SH)("/api/students/".concat(e.id));if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to fetch student details")}let a=await t.json();C(a),P({name:a.name||"",email:a.email||"",phone:a.phone||"",dob:a.dob?a.dob.split("T")[0]:""}),a.parents&&Array.isArray(a.parents)&&a.parents.length>0?L(a.parents.map(e=>({id:e.id,user_id:e.user_id,name:e.name||"",email:e.email||"",phone:e.phone||"",relationship:e.relationship||""}))):L([{name:"",email:"",phone:""}]),H(!0)}catch(e){console.error(e),i(e.message)}}async function removeStudent(e){if(confirm("X\xe1c nhận x\xf3a sinh vi\xean?"))try{let t=await (0,r.SH)("/api/students/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error(a.error||JSON.stringify(a));await load()}catch(e){i(e.message)}}return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:(0,d.t)("students.title","Học vi\xean")}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:function(){C(null),P({name:"",email:"",phone:"",dob:""}),L([{name:"",email:"",phone:""}]),H(!0)},title:(0,d.t)("students.actions.add","Th\xeam học vi\xean"),className:"p-2 rounded bg-blue-600 text-white hover:opacity-90",children:(0,s.jsx)(l.zy7,{})})})]}),a&&(0,s.jsx)("div",{className:"mb-3 text-red-600",children:a}),T&&(0,s.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black opacity-40",onClick:()=>H(!1)}),(0,s.jsxs)("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg p-6 w-full max-w-2xl z-50",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-3",children:S?"Edit student":"Add student"}),(0,s.jsxs)("form",{onSubmit:handleSave,className:"grid grid-cols-1 gap-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsx)("input",{value:E.name,onChange:e=>P(t=>({...t,name:e.target.value})),required:!0,placeholder:"Student name",className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"}),(0,s.jsx)("input",{value:E.email,onChange:e=>P(t=>({...t,email:e.target.value})),placeholder:"Student email",className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"}),(0,s.jsx)("input",{value:E.phone,onChange:e=>P(t=>({...t,phone:e.target.value})),placeholder:"Student phone",className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"}),(0,s.jsx)("input",{type:"date",value:E.dob,onChange:e=>P(t=>({...t,dob:e.target.value})),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h3",{className:"font-medium",children:(0,d.t)("students.parents.title","Phụ huynh / Người gi\xe1m hộ")}),(0,s.jsxs)("div",{className:"space-y-3 mt-2",children:[_.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[(0,s.jsx)("input",{value:e.name,onChange:e=>L(a=>{let s=[...a];return s[t]={...s[t],name:e.target.value},s}),placeholder:"Parent name",className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"}),(0,s.jsx)("input",{value:e.email,onChange:e=>L(a=>{let s=[...a];return s[t]={...s[t],email:e.target.value},s}),placeholder:"Parent email",className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"}),(0,s.jsx)("input",{value:e.phone,onChange:e=>L(a=>{let s=[...a];return s[t]={...s[t],phone:e.target.value},s}),placeholder:"Parent phone",className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600"}),(0,s.jsxs)("div",{className:"flex gap-2 items-center min-w-0",children:[(0,s.jsxs)("select",{value:e.relationship||"",onChange:e=>L(a=>{let s=[...a];return s[t]={...s[t],relationship:e.target.value},s}),className:"p-2 border rounded bg-transparent dark:bg-transparent dark:text-slate-100 dark:border-slate-600",children:[(0,s.jsx)("option",{value:"",children:(0,d.t)("students.parents.relationship","Quan hệ")}),(0,s.jsx)("option",{value:"father",children:(0,d.t)("students.parents.father","Cha")}),(0,s.jsx)("option",{value:"mother",children:(0,d.t)("students.parents.mother","Mẹ")}),(0,s.jsx)("option",{value:"guardian",children:(0,d.t)("students.parents.guardian","Người gi\xe1m hộ")}),(0,s.jsx)("option",{value:"other",children:(0,d.t)("students.parents.other","Kh\xe1c")})]}),(0,s.jsx)("button",{type:"button",onClick:async()=>{if(S&&e&&e.id){if(confirm((0,d.t)("students.parents.confirm_delete","X\xe1c nhận x\xf3a phụ huynh? T\xe0i khoản phụ huynh sẽ bị v\xf4 hiệu h\xf3a.")))try{let a=await (0,r.SH)("/api/parents/".concat(e.id),{method:"DELETE"}),s=await a.json().catch(()=>({}));if(!a.ok)throw Error(s.error||"Failed to remove parent");L(e=>e.filter((e,a)=>a!==t))}catch(e){i(e.message)}}else L(e=>e.filter((e,a)=>a!==t))},title:"Remove parent",className:"h-8 w-8 rounded bg-red-500 text-white flex items-center justify-center shrink-0",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,s.jsx)("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),(0,s.jsx)("path",{d:"M10 11v6"}),(0,s.jsx)("path",{d:"M14 11v6"})]})})]})]},t)),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"button",onClick:()=>L(e=>[...e,{name:"",email:"",phone:""}]),title:(0,d.t)("students.parents.add","Th\xeam phụ huynh"),className:"p-2 rounded bg-blue-600 text-white hover:opacity-90",children:(0,s.jsx)(l.zy7,{})})})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>H(!1),className:"px-3 py-2 border rounded",children:(0,d.t)("actions.cancel","Hủy")}),(0,s.jsx)("button",{type:"submit",className:"px-3 py-2 bg-green-600 text-white rounded",children:S?(0,d.t)("actions.update","Cập nhật"):(0,d.t)("actions.create","Tạo")})]})]})]})]}),(0,s.jsx)("div",{className:"bg-white dark:bg-slate-800 p-4 rounded",children:o?(0,s.jsx)("div",{children:"Loading..."}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative w-64",children:[(0,s.jsx)("input",{value:h,onChange:e=>u(e.target.value),placeholder:(0,d.t)("students.search.placeholder","T\xecm theo t\xean/email/sđt"),className:"p-2 pr-8 border rounded w-full bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600"}),h&&(0,s.jsx)("button",{onClick:()=>u(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700",children:"\xd7"})]}),(0,s.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,s.jsx)("option",{value:"name",children:"Sort by Name"}),(0,s.jsx)("option",{value:"email",children:"Sort by Email"}),(0,s.jsx)("option",{value:"phone",children:"Sort by Phone"})]}),(0,s.jsxs)("select",{value:x,onChange:e=>b(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,s.jsx)("option",{value:"asc",children:"Asc"}),(0,s.jsx)("option",{value:"desc",children:"Desc"})]}),(0,s.jsxs)("select",{value:g,onChange:e=>j(e.target.value),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,s.jsx)("option",{value:"",children:(0,d.t)("students.filter.all","Tất cả trạng th\xe1i")}),(0,s.jsx)("option",{value:"active",children:(0,d.t)("students.status.active","Hoạt động")}),(0,s.jsx)("option",{value:"inactive",children:(0,d.t)("students.status.inactive","Kh\xf4ng hoạt động")}),(0,s.jsx)("option",{value:"disabled",children:(0,d.t)("students.status.disabled","V\xf4 hiệu")})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Rows:"}),(0,s.jsxs)("select",{value:k,onChange:e=>y(parseInt(e.target.value,10)),className:"p-2 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,s.jsx)("option",{value:"5",children:"5"}),(0,s.jsx)("option",{value:"10",children:"10"}),(0,s.jsx)("option",{value:"25",children:"25"}),(0,s.jsx)("option",{value:"50",children:"50"})]})]})]}),(0,s.jsxs)("table",{className:"min-w-full table-auto",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left",children:[(0,s.jsx)("th",{className:"p-2",children:(0,s.jsx)("input",{type:"checkbox",onChange:e=>(function(e){let t=currentPageItems().map(e=>e.id);e?w(e=>Array.from(new Set([...e,...t]))):w(e=>e.filter(e=>!t.includes(e)))})(e.target.checked),checked:currentPageItems().every(e=>N.includes(e.id))&&currentPageItems().length>0})}),(0,s.jsx)("th",{className:"p-2",children:(0,d.t)("students.table.no","STT")}),(0,s.jsx)("th",{className:"p-2",children:(0,d.t)("students.table.name","Họ t\xean")}),(0,s.jsx)("th",{children:(0,d.t)("students.table.email","Email")}),(0,s.jsx)("th",{children:(0,d.t)("students.table.phone","SĐT")}),(0,s.jsx)("th",{children:(0,d.t)("students.table.dob","Ng\xe0y sinh")}),(0,s.jsx)("th",{children:(0,d.t)("students.table.status","Trạng th\xe1i")}),(0,s.jsx)("th",{children:(0,d.t)("students.table.actions","H\xe0nh động")})]})}),(0,s.jsx)("tbody",{children:currentPageItems().map((e,t)=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("input",{type:"checkbox",checked:N.includes(e.id),onChange:t=>w(a=>t.target.checked?Array.from(new Set([...a,e.id])):a.filter(t=>t!==e.id))})}),(0,s.jsx)("td",{className:"p-2",children:(v-1)*k+t+1}),(0,s.jsx)("td",{className:"p-2",children:e.name}),(0,s.jsx)("td",{children:e.email}),(0,s.jsx)("td",{children:e.phone}),(0,s.jsx)("td",{children:e.dob?e.dob.split("T")[0]:""}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsxs)("select",{value:e.status||"active",onChange:async t=>{let a=t.target.value;try{let t=await (0,r.SH)("/api/students/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:a})}),s=await t.json().catch(()=>({}));if(!t.ok)throw Error(s.error||"Failed to update status");await load()}catch(e){i(e.message)}},className:"p-1 border rounded bg-white dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600",children:[(0,s.jsx)("option",{value:"active",children:"active"}),(0,s.jsx)("option",{value:"inactive",children:"inactive"}),(0,s.jsx)("option",{value:"disabled",children:"disabled"})]})}),(0,s.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>editStudent(e),title:"Edit",className:"p-2 rounded bg-yellow-400 hover:opacity-90",children:(0,s.jsx)(l.vPQ,{})}),(0,s.jsx)("button",{onClick:()=>removeStudent(e.id),title:"Delete",className:"p-2 rounded bg-red-500 text-white hover:opacity-90",children:(0,s.jsx)(l.Ybf,{})})]})]},e.id))})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{disabled:v<=1,onClick:()=>f(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded mr-2",children:"Prev"}),(0,s.jsx)("button",{disabled:v>=totalPages(),onClick:()=>f(e=>Math.min(totalPages(),e+1)),className:"px-2 py-1 border rounded",children:"Next"})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Page ",v," / ",totalPages()," — ",filteredSorted().length," items"]}),(0,s.jsx)("div",{children:Array.from({length:totalPages()}).map((e,t)=>(0,s.jsx)("button",{onClick:()=>f(t+1),className:"px-2 py-1 border rounded ml-1 ".concat(v===t+1?"bg-slate-200":""),children:t+1},t))})]})]})})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);